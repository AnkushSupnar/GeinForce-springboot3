<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Registration page</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    
    

    <link rel="stylesheet" href="assets/bootstrap/bootstrap.min.css" crossorigin="anonymous">
    
    <script src="assets/js/jquery-3.2.1.slim.min.js"></script>  
      
    <script src="assets/js/popper.min.js"  crossorigin="anonymous"></script>
    <script src="assets/js/bootstrap.min.js"  crossorigin="anonymous"></script>
    <script src="assets/js/jquery-3.5.1.min.js"></script> 
    <script>
        $(function(){
            $("#navbar-placeholder").load("nav.html");
            
        });

        function showLoading() {
            document.getElementById('loading').style.visibility = 'visible';
        }

        function hideLoading() {
             document.getElementById('loading').style.visibility = 'hidden';
        }
    </script>
    <style>
        .active{
            text-decoration: underline;
        }
        .details {            
            font-weight: 500;
            margin-bottom: 5px;
        }
        .shadow{
    background-color: #1E2A78; /* Dark blue color */
    color: white;
    /*
    width: 150px;*/
    box-shadow: var(--bs-box-shadow) !important;
  }


        #institute-div {
            background-color: #f7f7f7;
        }
        .registration-form {
            background: #ffffff;
           padding: 30px 30px;
           
            border-radius: 10px;
            box-shadow: 0px 0px 10px 0px #0000001a;
            margin: 50px auto;
            margin-top: 0px;
            max-width: 800px;
        }
        .registration-form .form-group span {
            font-weight: 600;
            color: #333;
        }
        .registration-form h2 {
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        .btn-primary {
            background-color: #5cb85c;
            border-color: #5cb85c;
        }
        .btn-primary:hover {
            background-color: #4cae4c;
            border-color: #4cae4c;
        }



        /* Full-screen overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000; /* Ensure it's on top of other content */
    visibility: hidden; /* Hide initially */
}

/* Spinner styles */
.loading-spinner {
    border: 8px solid #f3f3f3; /* Light grey */
    border-top: 8px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 2s linear infinite;
}

/* Animation */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
    </style>
</head>
<body>
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>
    
    <div id="navbar-placeholder" class="container"></div>
    

    <div class="container text-center">

    </div>
    <div class="container bg-light text-center">
        <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link active font-weight-bold " onclick="selectTab('student')" >Individual Registration</a>
            </li>
           
            <li class="nav-item">
              <a class="nav-link " onclick="selectTab('institute-div')" >Institutes Registration</a>
            </li>
            
          </ul>
    </div>
    
   
    <div class="container bg-light " id="student">       
        <div class="container">
            <div class="registration-form">
                <h2>Register Now</h2>
                <form id="student-form">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <span>First Name:</span>
                            <input type="text" class="form-control" id="firstName" name="firstName" placeholder="Enter First Name">
                        </div>
                        <div class="form-group col-md-6">
                            <span>Last Name:</span>
                            <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Enter Last Name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <span>Email:</span>
                            <input type="email" class="form-control" id="email" name="email" placeholder="Enter Email">
                        </div>
                        <div class="form-group col-md-6">
                            <span>Mobile:</span>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <select class="form-control" id="countryCode" name="countryCode" style="max-width: 100px;">
                                        <option selected value="+91">+91</option>
                                        <option value="+44">+44</option>
                                        <option value="+81">+81</option>
                                    </select>
                                </div>
                                <input type="text" class="form-control" id="mobile" name="mobile" placeholder="Enter Mobile">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="instituteCheck" name="instituteCheck">
                                <label class="form-check-label" for="instituteCheck">
                                    <span class="details">
                                        Is Your Institute Registered? 
                                    </span>
                                </label>                        
                            </div>
                        </div>
                    </div>
                    <div class="row" id="instituteName-div">
                        <div class="form-group col-md-12">
                            <span>Institute Name:</span>
                            <input type="text" class="form-control" id="instituteId" name="instituteId" placeholder="Enter Institute ID">
                        </div>
                    </div>
                    <div class="row" id="selectInstitute-div" style="display: none;">
                        <div class="form-group col-md-12">
                            <span>Select Institute Name:</span>
                            <select class="form-control" id="institute" name="institute">
                               
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <span>Department:</span>
                            <input type="text" class="form-control" id="department" name="department" placeholder="Enter Department">
                        </div>
                        <div class="form-group col-md-6">
                            <span>Purpose:</span>
                            <select class="form-control" id="purpose" name="purpose">
                                <option value="">Select Purpose</option>
                                <option value="Research">Academic Institute</option>
                                <option value="Academic">Industry</option>
                                <option value="Industrial">Research Lab</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <span>City:</span>
                            <input type="text" class="form-control" id="city" name="city" placeholder="Enter City">
                        </div>
                        <div class="form-group col-md-4">
                            <span>State:</span>
                            <input type="text" class="form-control" id="state" name="state" placeholder="Enter State">
                        </div>
                        <div class="form-group col-md-4">
                            <span>Country:</span>
                            <input type="text" class="form-control" id="country" name="country" placeholder="Enter Country">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="terms" name="terms">
                            <label class="form-check-label" for="terms">
                                <span class="details">
                                    I agree to the terms and conditions  <a href="Terms of Use.html" >Read more</a>
                                </span>
                                
                            </label>                        
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <button type="button" id="student-otpbutton" class="btn  btn-block " onclick="getOtp('student-form')" disabled style=" background-color: #1E2A78; color: white;box-shadow: var(--bs-box-shadow) !important;">Get OTP</button>
                        </div>
                    </div>
                    <div class="d-none" id="stud-otp-div">      
                        <div class="form-row">
                            <div class="form-group col">
                                <span>OTP:</span>
                                <input type="text" class="form-control" id="stud-otp" name="stud-otp" placeholder="Enter OTP">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-12 col-md-6">
                                <span>Enter New Password:</span>
                                <input type="password" class="form-control" id="stud-newpassword" name="stud-newpassword"  placeholder="Enter New Password">
                            </div>
                            <div class="form-group col-12 col-md-6">
                                <span>Confirm Password:</span>
                                <input type="password" class="form-control" id="stud-confirmpassword" name="stud-confirmpassword"  placeholder="Confirm Your New Password">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <button  type="button" id="stud-verify" class="btn  btn-block " onclick="verifyUser('student-form')"    style=" background-color: #1E2A78; color: white;box-shadow: var(--bs-box-shadow) !important;">
                                    Verify and Submit</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    
    
    
    <div class="container d-none " id="institute-div">
        <div class="container">
            <div class="registration-form">
                <h2>Register Now</h2>
                <form id="inst-form">
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <span>Institute Name:</span>
                            <input type="text" class="form-control" id="institute_name" name="institute_name" placeholder="Enter Institute Name">
                        </div>
                       
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <span>Department Name:</span>
                            <select class="form-control" id="institute_department" name="institute_department" required>
                                <option value="">Please select Department</option>
                                <option value="Pharmaceutical Chemistry">Pharmaceutical Chemistry</option>
                                <option value="Medicinal Chemistry">Medicinal Chemistry</option>
                                <option value="Pharmaceutics">Pharmaceutics</option>
                                <option value="Pharmacology">Pharmacology</option>
                                <option value="Bioinformatics">Bioinformatics</option>
                            </select>

                        </div>
                       
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <span>Email:</span>
                            <input type="email" class="form-control" name="instituteEmail" id="instituteEmail" placeholder="Enter Email">
                        </div>
                        <div class="form-group col-md-6">
                            <span>Mobile:</span>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <select class="form-control" id="instituteCode" name="instituteCode" style="max-width: 100px;">
                                        <option selected value="+91">+91</option>
                                        <option value="+44">+44</option>
                                        <option value="+81">+81</option>
                                    </select>
                                </div>
                                <input type="text" class="form-control" id="instituteMobile" name="instituteMobile" placeholder="Enter Mobile">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <span>City:</span>
                            <input type="text" class="form-control" id="instituteCity" name="instituteCity" placeholder="Enter City">
                        </div>
                        <div class="form-group col-md-4">
                            <span>State:</span>
                            <input type="text" class="form-control" id="instituteState" name="instituteState" placeholder="Enter State">
                        </div>
                        <div class="form-group col-md-4">
                            <span>Country:</span>
                            <input type="text" class="form-control" id="instituteCountry" name="instituteCountry" placeholder="Enter Country">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="inst-terms">
                            <label class="form-check-label" for="inst-terms">
                                <span class="details">
                                    I agree to the terms and conditions <a href="Terms of Use.html" >Read more</a>
                                </span>
                            </label>                        
                          </div>
                        
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <button  type="button" id="inst-getotp" class="btn  btn-block " onclick="getOtp('inst-form')" disabled style=" background-color: #1E2A78; color: white;box-shadow: var(--bs-box-shadow) !important;">Get OTP</button>
                        </div>
                    </div>
                    <div class="d-none" id="inst-otp-div">
                        <div class="form-row " >
                            <div class="form-group col-12">
                                <span>Enter OTP:</span>
                                <input type="text" class="form-control" id="inst-otp" name="inst-otp"  placeholder="Enter OTP">
                            </div>
                        </div>
                    
                        <div class="form-row">
                            <div class="form-group col-12 col-md-6">
                                <span>Enter New Password:</span>
                                <input type="password" class="form-control" id="inst-newpassword" name="inst-newpassword"  placeholder="Enter New Password">
                            </div>
                            <div class="form-group col-12 col-md-6">
                                <span>Confirm Password:</span>
                                <input type="password" class="form-control" id="inst-confirmpassword" name="inst-confirmpassword"  placeholder="Confirm Your New Password">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <button  type="button" id="inst-verify" class="btn  btn-block " onclick="verifyUser('inst-form')"    style=" background-color: #1E2A78; color: white;box-shadow: var(--bs-box-shadow) !important;">
                                    Verify and Submit</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        

    </div>
</body>
<script>
document.getElementById('terms').addEventListener('change', function() {
   
    var getOtpButton = document.getElementById('student-otpbutton');
    getOtpButton.disabled = !this.checked;
});
document.getElementById('inst-terms').addEventListener('change', function() {
   
   var getOtpButton = document.getElementById('inst-getotp');
   getOtpButton.disabled = !this.checked;
});

document.getElementById('instituteCheck').addEventListener('change', function() {
    var enterInst = document.getElementById('instituteName-div');
    var selectInst = document.getElementById('selectInstitute-div');
   if(this.checked){
    loadInstituteNames();
    enterInst.style.display='none';
    selectInst.style.display='block';
   }
   else{
    
    enterInst.style.display='block';
    selectInst.style.display='none';
   }

   var getOtpButton = document.getElementById('student-otpbutton');
   getOtpButton.disabled = !this.checked;
});




    function selectTab(rtype){
       
        // Hide all registration divs
        document.getElementById('student').classList.add('d-none');
        
        document.getElementById('institute-div').classList.add('d-none');
        
        // Show the selected registration div
        document.getElementById(rtype).classList.remove('d-none');
         // Update active tab
         var tabs = document.querySelectorAll('.nav-link');
            tabs.forEach(function(tab) {
                tab.classList.remove('active', 'font-weight-bold');
            });
            var activeTab = document.querySelector('.nav-link[onclick*="'+rtype+'"]');
            activeTab.classList.add('active', 'font-weight-bold');
    }

    function validate(type) {
    var form = document.getElementById(type);
    var selectInstitute = document.getElementById('instituteCheck');
    
    if(selectInstitute.checked){
        // alert('checked');
    } else {
        // alert('Unchecked');
    }

    

    var emptyField = "";

    if (type === 'inst-form' || type === 'student-form') {
        var inputs = form.querySelectorAll('input, select');

        for (var i = 0; i < inputs.length; i++) {
            var input = inputs[i];
            if (input.name !== "" && input.value.trim() === "" && emptyField === "" &&
                input.name !== 'inst-newpassword' && input.name !== 'inst-confirmpassword' &&
                input.name !== 'inst-otp' && input.name !== 'instituteCheck') {
                
                if(input.name === 'instituteId' && !selectInstitute.checked) {
                    console.log(input.name);
                console.log(input.value);
                    continue; // Skip this input if the checkbox is not checked
                }

                emptyField = input.name;
                console.log(input.name);
                console.log(input.value);
                alert("Please Enter Value for " + input.name);
                break; // Stop further iteration once the first empty field is found
            }
        }

        // If an empty field was found, prevent form submission
        if (emptyField !== "") {
            return false; // Form will not be submitted
        } else {
            return true; // Form will be submitted
        }
    }
}
    function validateForm(type){
        if (type === 'student-form') {
        // Check First Name
        if (document.getElementById('firstName').value.trim() === '') {
            alert("Please Enter First Name");
            return false;
        }

        // Check Last Name
        if (document.getElementById('lastName').value.trim() === '') {
            alert("Please Enter Last Name");
            return false;
        }

        // Check Email
        if (document.getElementById('email').value.trim() === '') {
            alert("Please Enter Email");
            return false;
        }

        // Check Mobile
        if (document.getElementById('mobile').value.trim() === '') {
            alert("Please Enter Mobile Number");
            return false;
        }

        // Check Institute Registered Checkbox
        if (document.getElementById('instituteCheck').checked) {
            // If checked, check the Select Institute dropdown
            if (document.getElementById('institute').value.trim() === '') {
                alert("Please Select Institute Name");
                return false;
            }
        } else {
            // If not checked, check the Institute ID field
            if (document.getElementById('instituteId').value.trim() === '') {
                alert("Please Enter Institute ID");
                return false;
            }
        }

        // Check Department
        if (document.getElementById('department').value.trim() === '') {
            alert("Please Enter Department");
            return false;
        }

        // Check Purpose
        if (document.getElementById('purpose').value.trim() === '') {
            alert("Please Select Purpose");
            return false;
        }

        // Check City
        if (document.getElementById('city').value.trim() === '') {
            alert("Please Enter City");
            return false;
        }

        // Check State
        if (document.getElementById('state').value.trim() === '') {
            alert("Please Enter State");
            return false;
        }

        // Check Country
        if (document.getElementById('country').value.trim() === '') {
            alert("Please Enter Country");
            return false;
        }

        // Check Terms and Conditions Checkbox
        if (!document.getElementById('terms').checked) {
            alert("You must agree to the terms and conditions");
            return false;
        }

        // If all fields are valid
        return true;
    }
    if (type === 'inst-form') {
        // Validate Institute Form Fields
        if (document.getElementById('institute_name').value.trim() === '') {
            alert("Please Enter Institute Name");
            return false;
        }
        if (document.getElementById('institute_department').value.trim() === '') {
            alert("Please Select Department");
            return false;
        }
        if (document.getElementById('instituteEmail').value.trim() === '') {
            alert("Please Enter Email");
            return false;
        }
        if (document.getElementById('instituteMobile').value.trim() === '') {
            alert("Please Enter Mobile Number");
            return false;
        }
        if (document.getElementById('instituteCity').value.trim() === '') {
            alert("Please Enter City");
            return false;
        }
        if (document.getElementById('instituteState').value.trim() === '') {
            alert("Please Enter State");
            return false;
        }
        if (document.getElementById('instituteCountry').value.trim() === '') {
            alert("Please Enter Country");
            return false;
        }
        if (!document.getElementById('inst-terms').checked) {
            alert("You must agree to the terms and conditions");
            return false;
        }
        return true; // If all validations pass
    }

}


    function getOtp(type){
      
    var form  = document.getElementById(type);
    var inputs = form.querySelectorAll('input');
    
    
    // if(type=='inst-form' && !validate(type)){
    //     return;
    // }
    if( !validateForm(type)){
        return ;
    }
    showLoading();
    
    var formData = new FormData(form);
        
    var formObject = {};
    formData.forEach((value, key) => {
        formObject[key] = value;
    });
    formObject['verification_method'] = 'Email';
    if (type === 'student-form') {
        formObject['verification_method'] = 'Email';
        formObject['is_institute'] = false;
        var selectInst = document.getElementById('instituteCheck');
        if(selectInst.checked){
            formObject['is_student'] = true;    
        }
        else{
            formObject['is_student'] =false;
        }
        
        formObject['country_code'] = formObject['countryCode'];
        delete formObject['countryCode'];

        formObject['first_name'] = formObject['firstName'];
        delete formObject['firstName'];

        formObject['last_name'] = formObject['lastName'];
        delete formObject['lastName'];

        formObject['select_institute'] = formObject['institute'];
        
        formObject['institute_name'] = formObject['instituteId'];
        formObject['institute'] = formObject['instituteId'];
        

        
    }
    if (type === 'inst-form') {
        
        formObject['is_institute'] = true;
        formObject['is_student'] = false;
        formObject['email'] = formObject['instituteEmail'];
        delete formObject['instituteEmail'];
        
        formObject['country_code'] = formObject['instituteCode'];
        delete formObject['instituteCode'];
        
        formObject['mobile'] = formObject['instituteMobile'];
        delete formObject['instituteMobile'];
        
        formObject['city'] = formObject['instituteCity'];
        delete formObject['instituteCity'];

        formObject['state'] = formObject['instituteState'];
        delete formObject['instituteState'];

        
        formObject['country'] = formObject['instituteCountry'];
        delete formObject['instituteCountry'];

    }
    console.log(formObject);
     // Make a POST request to the /register endpoint
     fetch('/api/register', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'  // Specify the content type
        },
        body: JSON.stringify(formObject)  // Convert the object to a JSON string
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text(); // or response.json() if your API returns a JSON response
    })
    .then(data => {
        console.log('Success:', data);
     //   alert('OTP sent successfully!');  // Handle success

     
     
     if (!data.startsWith('failed:')&& !data.startsWith('Fail:')) {
        alert("Please enter OTP recieved in Email");
     if (type === 'inst-form') {
        hideShowOTPDIV('inst-otp-div');
     }
     if (type === 'student-form') {
        hideShowOTPDIV('stud-otp-div');
     }
     
    }
    else{
        alert(data);
    }
     hideLoading();
     
    })
    .catch((error) => {
        console.error('Error:', error);
        hideLoading();
        alert('An error occurred while sending OTP');  // Handle error
    });
    
}
    function verifyUser(type){
       // alert("verify");
        var form = document.getElementById(type);
        var formData = new FormData(form);
        console.log(formData);
        var email;
        var otp;
        var password;
        var confirmPassword;
        if(type=='inst-form'){
            email = formData.get('instituteEmail');
            otp = formData.get('inst-otp');
            password = formData.get('inst-newpassword');
            confirmPassword = formData.get('inst-confirmpassword');
        }
        else if(type=='student-form'){
            email = formData.get('email');
            otp=formData.get('stud-otp');
            password = formData.get('stud-newpassword');
            confirmPassword = formData.get('stud-confirmpassword');
        }
        console.log(email,otp,password);
        if(otp==''){
            alert("Please Enter OTP Recieved On Email");
            return;
        }
        if(password==''){
            alert("Please Enter New Password");
            return;
        }
        if(confirmPassword==''){
            alert("Please Enter Confirm Password");
            return;
        }
        if(password!=confirmPassword){
            alert('New Password And COnfirm Password Must Be Same');
            return;
        }
        var payload = {
        email: email,
        otp: otp,
        password: password
    };
    var queryString = `email=${encodeURIComponent(email)}&otp=${encodeURIComponent(otp)}&password=${encodeURIComponent(password)}`;
    showLoading(); 
    fetch(`/api/verifyUser?${queryString}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        }
    })
    .then(response => {
        hideLoading(); // Hide loading spinner
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text();
    })
    .then(data => {
        console.log('Success:', data);
      //  alert('User verified successfully!');  // Handle success
        alert("Your details have been successfully submitted. You will be able to log in once your account has been reviewed and approved by the Admin Center.");
        window.location.assign("index.html");
    })
    .catch((error) => {
        console.error('Error:', error);
        alert('An error occurred while verifying the user');  // Handle error
    });



    }
    function hideShowOTPDIV(divId){

        document.getElementById(divId).classList.remove('d-none');

    }
    function loadInstituteNames(){
        
        const selectElement = document.getElementById("institute");

        fetch("/api/verifiedInstituteNames")
            .then(response => {
                if (response.status === 204) {                    
                    const option = document.createElement("option");
                    option.text = "No institutes found";
                    option.value="noInstitutes";
                    selectElement.add(option);
                    throw new Error("No institutes found");
                } else if (!response.ok) {
                throw new Error("Error fetching institute names: " + response.status);
                }
                return response.json();
            })
            .then(data => {
                data.forEach(instituteName => {
                    const option = document.createElement("option");
                    option.text = instituteName;
                    option.value=instituteName;
                    selectElement.add(option);
                });
            })
        .catch(error => {
            console.log(error);
        });
    }

</script>

</html>